<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Perfect Competition Plot</title>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 15px;
            background-color: #f5f5f5;
            max-width: 800px;
            margin: 0 auto;
        }
        .container {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        .plots-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        .plot {
            flex: 1;
            height: 350px;
            border: 1px solid #ddd;
            border-radius: 5px;
            min-width: 0;
        }
        .controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }
        .slider-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .slider-container label {
            min-width: 120px;
            font-weight: bold;
            font-size: 0.9em;
        }
        .slider-container input {
            flex: 1;
        }
        .value-display {
            min-width: 40px;
            text-align: right;
            font-size: 0.9em;
        }
        .info-box {
            margin-top: 15px;
            padding: 12px;
            background-color: #e8f4fd;
            border-left: 4px solid #2196F3;
            border-radius: 4px;
            font-size: 0.85em;
        }
        @media (max-width: 600px) {
            .plots-container {
                flex-direction: column;
            }
            .plot {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Interactive Perfect Competition Analysis</h1>
        
        <div class="plots-container">
            <div id="short-run-plot" class="plot"></div>
            <div id="long-run-plot" class="plot"></div>
        </div>
        
        <div class="controls">
            <h3 style="margin: 0 0 10px 0; font-size: 1.1em;">Adjust Parameters</h3>
            <div class="slider-container">
                <label for="price-slider">Price (P):</label>
                <input type="range" id="price-slider" min="20" max="70" step="1" value="50">
                <span id="price-value" class="value-display">50</span>
            </div>
            
            <div class="slider-container">
                <label for="tfc-slider">TFC:</label>
                <input type="range" id="tfc-slider" min="50" max="300" step="10" value="150">
                <span id="tfc-value" class="value-display">150</span>
            </div>
            
            <div class="slider-container">
                <label for="avc-slider">AVC Coef:</label>
                <input type="range" id="avc-slider" min="0.005" max="0.02" step="0.001" value="0.01">
                <span id="avc-value" class="value-display">0.01</span>
            </div>
            
            <div class="slider-container">
                <label for="q0-slider">LR Q0:</label>
                <input type="range" id="q0-slider" min="30" max="70" step="1" value="50">
                <span id="q0-value" class="value-display">50</span>
            </div>
            
            <div class="info-box">
                <p><strong>Instructions:</strong> Adjust sliders to see how price and costs affect equilibrium in short-run and long-run scenarios. In the long-run, P = MC = min(ATC).</p>
            </div>
        </div>
    </div>

    <script>
        // Initialize with default values
        let price = 50;
        let TFC = 150;
        let avcCoefficient = 0.01;
        let Q0 = 50;
        
        // Generate quantity range
        const Q = Array.from({length: 500}, (_, i) => 1 + i * 109/499);
        
        // Function to update plots
        function updatePlots() {
            // Update displayed values
            document.getElementById('price-value').textContent = price;
            document.getElementById('tfc-value').textContent = TFC;
            document.getElementById('avc-value').textContent = avcCoefficient.toFixed(3);
            document.getElementById('q0-value').textContent = Q0;
            
            // Calculate curves for short-run
            const AVC = Q.map(q => avcCoefficient * Math.pow(q, 2) - 0.8 * q + 40);
            const AFC = Q.map(q => TFC / q);
            const ATC = Q.map((q, i) => AVC[i] + AFC[i]);
            const MC = Q.map(q => 0.024 * Math.pow(q, 2) - 1.6 * q + 40);
            const MR = Q.map(() => price);
            
            // Find equilibrium point (MC = MR)
            let eqIndex = 0;
            let minDiff = Math.abs(MC[0] - price);
            for (let i = 1; i < MC.length; i++) {
                const diff = Math.abs(MC[i] - price);
                if (diff < minDiff) {
                    minDiff = diff;
                    eqIndex = i;
                }
            }
            
            const eqQuantity = Q[eqIndex];
            const eqATC = ATC[eqIndex];
            const profitPerUnit = price - eqATC;
            const totalProfit = profitPerUnit * eqQuantity;
            
            // Calculate curves for long-run
            // In long-run equilibrium, price equals min ATC and equals MC at Q0
            const min_ATC = price; // Bound to the price slider
            const ATC_lr = Q.map(q => 0.02 * Math.pow(q - Q0, 2) + min_ATC);
            const MC_lr = Q.map(q => 0.02 * (3 * Math.pow(q, 2) - 4 * Q0 * q + Math.pow(Q0, 2)) + min_ATC);
            const P_lr = min_ATC;
            const MR_lr = Q.map(() => P_lr);
            
            // Find the equilibrium point where MC = min_ATC (which is at Q0)
            const eq_quantity_lr = Q0;
            
            // Create short-run plot
            const shortRunTrace1 = {
                x: Q,
                y: MC,
                mode: 'lines',
                name: 'MC',
                line: {color: 'black', width: 2}
            };
            
            const shortRunTrace2 = {
                x: Q,
                y: ATC,
                mode: 'lines',
                name: 'ATC',
                line: {color: 'blue', width: 2}
            };
            
            const shortRunTrace3 = {
                x: Q,
                y: AVC,
                mode: 'lines',
                name: 'AVC',
                line: {color: 'orange', width: 2}
            };
            
            const shortRunTrace4 = {
                x: Q,
                y: MR,
                mode: 'lines',
                name: 'P = MR = D',
                line: {color: 'green', width: 2, dash: 'dash'}
            };
            
            const shortRunTrace5 = {
                x: [eqQuantity, eqQuantity],
                y: [0, 120],
                mode: 'lines',
                name: 'Optimal Q',
                line: {color: 'red', width: 1.5, dash: 'dot'},
                showlegend: false
            };
            
            const shortRunTrace6 = {
                x: [eqQuantity],
                y: [price],
                mode: 'markers',
                name: 'Equilibrium',
                marker: {color: 'red', size: 8},
                showlegend: false
            };
            
            // Create profit area (rectangle) - changed to green
            const profitArea = {
                x: [0, eqQuantity, eqQuantity, 0, 0],
                y: [eqATC, eqATC, price, price, eqATC],
                mode: 'lines',
                fill: 'toself',
                fillcolor: 'rgba(0, 200, 0, 0.2)',
                line: {width: 0},
                name: `Profit: $${totalProfit.toFixed(1)}`,
                showlegend: false
            };
            
            // Create profit text annotation - moved to middle of colored area and changed to green
            const profitText = {
                x: [eqQuantity / 2],
                y: [(price + eqATC) / 2], // Middle of the profit area vertically
                mode: 'text',
                text: [`Profit: $${totalProfit.toFixed(1)}`],
                textposition: 'middle center',
                textfont: {
                    size: 12,
                    color: 'green',
                    weight: 'bold'
                },
                showlegend: false,
                hoverinfo: 'skip'
            };
            
            const shortRunLayout = {
                title: `Short Run<br>Price: $${price}`,
                xaxis: {title: 'Quantity (Q)', range: [2, 110]},
                yaxis: {title: 'Cost / Price', range: [0, 120]},
                showlegend: true,
                legend: {x: 0, y: 1, font: {size: 10}},
                margin: {l: 50, r: 30, t: 50, b: 50},
                annotations: [
                    {
                        x: eqQuantity,
                        y: 15,
                        xref: 'x',
                        yref: 'y',
                        text: `Q* = ${eqQuantity.toFixed(1)}`,
                        showarrow: true,
                        arrowhead: 7,
                        ax: 0,
                        ay: 30,
                        bgcolor: 'rgba(255, 255, 255, 0.8)',
                        bordercolor: 'red',
                        borderwidth: 1,
                        font: {size: 10}
                    }
                ]
            };
            
            Plotly.react('short-run-plot', 
                [shortRunTrace1, shortRunTrace2, shortRunTrace3, shortRunTrace4, 
                 shortRunTrace5, shortRunTrace6, profitArea, profitText], 
                shortRunLayout);
            
            // Create long-run plot
            const longRunTrace1 = {
                x: Q,
                y: MC_lr,
                mode: 'lines',
                name: 'MC',
                line: {color: 'black', width: 2}
            };
            
            const longRunTrace2 = {
                x: Q,
                y: ATC_lr,
                mode: 'lines',
                name: 'ATC',
                line: {color: 'blue', width: 2}
            };
            
            const longRunTrace3 = {
                x: Q,
                y: MR_lr,
                mode: 'lines',
                name: 'P = MR = D',
                line: {color: 'green', width: 2, dash: 'dash'}
            };
            
            // Add vertical line in long-run plot
            const longRunTrace4 = {
                x: [eq_quantity_lr, eq_quantity_lr],
                y: [0, 120],
                mode: 'lines',
                name: 'Optimal Q',
                line: {color: 'red', width: 1.5, dash: 'dot'},
                showlegend: false
            };
            
            const longRunTrace5 = {
                x: [eq_quantity_lr],
                y: [P_lr],
                mode: 'markers',
                name: 'Long-Run Equilibrium',
                marker: {color: 'red', size: 8}
            };
            
            // Add zero profit text to long-run plot - moved to lower right of the point
            const zeroProfitText = {
                x: [eq_quantity_lr + 8],
                y: [P_lr - 10],
                mode: 'text',
                text: ['Profit: $0.0'],
                textposition: 'middle right',
                textfont: {
                    size: 12,
                    color: 'gray',
                    weight: 'bold'
                },
                showlegend: false,
                hoverinfo: 'skip'
            };
            
            const longRunLayout = {
                title: `Long Run<br>P = MC = min(ATC) = $${min_ATC}`,
                xaxis: {title: 'Quantity (Q)', range: [1, 110]},
                yaxis: {title: 'Cost / Price', range: [0, 120]},
                showlegend: true,
                legend: {x: 0, y: 1, font: {size: 10}},
                margin: {l: 50, r: 30, t: 50, b: 50},
                annotations: [
                    {
                        x: eq_quantity_lr,
                        y: 15,
                        xref: 'x',
                        yref: 'y',
                        text: `Q* = ${eq_quantity_lr.toFixed(1)}`,
                        showarrow: true,
                        arrowhead: 7,
                        ax: 0,
                        ay: 30,
                        bgcolor: 'rgba(255, 255, 255, 0.8)',
                        bordercolor: 'red',
                        borderwidth: 1,
                        font: {size: 10}
                    }
                ]
            };
            
            Plotly.react('long-run-plot', 
                [longRunTrace1, longRunTrace2, longRunTrace3, longRunTrace4, longRunTrace5, zeroProfitText], 
                longRunLayout);
        }
        
        // Set up event listeners for sliders
        document.getElementById('price-slider').addEventListener('input', function() {
            price = parseFloat(this.value);
            updatePlots();
        });
        
        document.getElementById('tfc-slider').addEventListener('input', function() {
            TFC = parseFloat(this.value);
            updatePlots();
        });
        
        document.getElementById('avc-slider').addEventListener('input', function() {
            avcCoefficient = parseFloat(this.value);
            updatePlots();
        });
        
        document.getElementById('q0-slider').addEventListener('input', function() {
            Q0 = parseFloat(this.value);
            updatePlots();
        });
        
        // Initialize plots
        updatePlots();
    </script>
</body>
</html>